# Патч для Apple Silicon (M процессоры)

Этот патч автоматически настраивает сборку проекта Alfis для Apple Silicon (M1, M2, M3, M4) процессоров.

## Что включает патч:

### 1. Автоматическая настройка компилятора C
- Устанавливает `CC_aarch64-apple-darwin="clang -Wno-int-conversion"`
- Подавляет предупреждения о несовместимости типов в C коде
- Работает для обеих архитектур: Apple Silicon и Intel Mac

### 2. Оптимизации для Apple Silicon
- Включает LTO (Link Time Optimization)
- Устанавливает `codegen-units = 1` для лучшей оптимизации
- Включает `strip = true` для уменьшения размера бинарника
- Настраивает `panic = "abort"` для лучшей производительности

### 3. Настройки для GUI
- Автоматически подключает фреймворки Cocoa и WebKit
- Настраивает правильные флаги линковщика для macOS

## Результаты оптимизации:

| Версия | Размер | Оптимизация |
|--------|--------|-------------|
| Debug  | 7.6 MB | Базовая отладка |
| Release| 3.8 MB | Полная оптимизация (-50%) |

## Использование:

### Обычная сборка с GUI:
```bash
cargo build --features webgui
```

### Оптимизированная сборка:
```bash
cargo build --release --features webgui
```

### Сборка без GUI:
```bash
cargo build --features "" --no-default-features
```

## Файлы патча:

- `.cargo/config.toml` - основная конфигурация Cargo
- Автоматически применяется при каждой сборке
- Не требует дополнительных действий от пользователя

## Совместимость:

- ✅ Apple Silicon (M1, M2, M3, M4)
- ✅ Intel Mac (для кросс-компиляции)
- ✅ macOS 10.15+ (Catalina и новее)
- ✅ Rust 1.70+

## Устранение проблем:

Если возникают проблемы с компиляцией C кода, убедитесь что:
1. Установлен Xcode Command Line Tools: `xcode-select --install`
2. Используется актуальная версия Rust: `rustup update`
3. Очистите кэш сборки: `cargo clean`

## Технические детали:

Патч решает проблему компиляции библиотеки `webview-sys`, которая содержит C код с предупреждениями о несовместимости типов. Флаг `-Wno-int-conversion` подавляет эти предупреждения, позволяя сборке завершиться успешно на современных версиях Clang.
